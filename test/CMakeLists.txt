cmake_minimum_required(VERSION 3.12)
project(UnitTests C)
set(CMAKE_C_STANDARD 11)
enable_testing()

# ==========================================
# 1. è¨­å®š Unity è·¯å¾‘ (å…¨åŸŸè®Šæ•¸)
# ==========================================
# ç¢ºä¿é€™å€‹è·¯å¾‘æŒ‡å‘ä½ ä¸‹è¼‰ unity.c çš„åœ°æ–¹ (test/unity)
set(UNITY_SRC ${CMAKE_CURRENT_SOURCE_DIR}/../lib/unity/src/unity.c)
set(UNITY_INCLUDE ${CMAKE_CURRENT_SOURCE_DIR}/../lib/unity/src)

# ==========================================
# 2. æ¸¬è©¦ç›®æ¨™ 1: Sentinel Core (App Logic)
# ==========================================
add_executable(run_tests
    test_sentinel.c
    ${UNITY_SRC}
    ../src/app/sentinel_core.c
)
target_include_directories(run_tests PRIVATE
    ${UNITY_INCLUDE}
    ../src/app
)
add_test(NAME SentinelCoreTest COMMAND run_tests)

# ==========================================
# 3. æ¸¬è©¦ç›®æ¨™ 2: Ring Buffer (Day 7 æ–°å¢) âœ…
# ==========================================
add_executable(test_ring_buffer
    test_ring_buffer.c
    ${UNITY_SRC}
    ../src/common/ring_buffer.c
)
target_include_directories(test_ring_buffer PRIVATE
    ${UNITY_INCLUDE}
    ../src/common
)
add_test(NAME RingBufferTest COMMAND test_ring_buffer)

# ==========================================
# 4. æ¸¬è©¦ç›®æ¨™ 3: HAL UART (Day 8 Observer Pattern) âœ… NEW!
# ==========================================
# é€™è£¡å°‡ test_hal_uart.c èˆ‡å¯¦ä½œ hal_uart.c é€£çµ
add_executable(test_hal_uart
    test_hal_uart.c
    ${UNITY_SRC}
    ../src/hal/hal_uart.c
)

# è¨­å®š Include Pathï¼Œè®“ test_hal_uart.c èƒ½æ‰¾åˆ° "hal_uart.h"
target_include_directories(test_hal_uart PRIVATE
    ${UNITY_INCLUDE}
    ../src/hal
)

# è¨»å†Šæ¸¬è©¦æ¡ˆä¾‹åˆ° CTest
add_test(NAME HalUartTest COMMAND test_hal_uart)

# ==========================================
# 5. æ¸¬è©¦ç›®æ¨™ 3: DMA Driver (Day 6) ğŸ› ï¸ ä¿®æ­£è™•
# ==========================================
#add_executable(test_dma
#    test_hal_uart_dma.c
 #   ${UNITY_SRC}
    # æ³¨æ„ï¼šä¸è¦åŠ å…¥ ../src/hal/hal_uart_dma.cï¼Œå› ç‚º test æª”è£¡å·²ç¶“ include äº† .c
#)

#target_include_directories(test_dma PRIVATE
 #   ${UNITY_INCLUDE}                       # <--- [é—œéµä¿®æ­£] ä¹‹å‰é€™è£¡æ¼äº†æˆ–å¯«éŒ¯äº†ï¼Œå°è‡´æ‰¾ä¸åˆ° unity.h
  #  ../src
   # ${CMAKE_CURRENT_SOURCE_DIR}/mock_headers 
#)

#add_test(NAME DmaDriverTest COMMAND test_dma)